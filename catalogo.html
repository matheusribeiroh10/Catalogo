<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta 
  name="viewport" 
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
>
<title>CatÃ¡logo Digital</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f7f7f7;
    text-align: center;
  }

  header {
    background: #2b7bba;
    color: white;
    padding: 12px;
    font-size: 20px;
    font-weight: bold;
    position: sticky;
    top: 0;
    z-index: 10;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #total {
    font-size: 16px;
    font-weight: bold;
  }

  header button {
    padding: 8px 12px;
    font-size: 14px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-weight: bold;
  }

  #enviarBtn {
    background-color: #25d366;
    color: white;
  }

  #voltarBtn {
    background-color: #ff5c5c;
    color: white;
  }

  #produtos-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding: 12px;
    max-width: 700px;
    margin: auto;
  }

  .produto {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    padding: 10px;
  }

  .produto img {
    width: 100%;
    border-radius: 10px;
  }

  .qtd-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 5px;
  }

  .qtd-container button {
    width: 28px;
    height: 28px;
    border: none;
    border-radius: 6px;
    background: #2b7bba;
    color: white;
    font-size: 18px;
    font-weight: bold;
  }

  .qtd-container input {
    width: 40px;
    text-align: center;
    margin: 0 5px;
    border: 1px solid #ccc;
    border-radius: 6px;
    pointer-events: none;
  }
</style>
</head>
<body>

<header>
  <button id="voltarBtn" onclick="voltar()">â¬… Marcas</button>
  <div>
    CatÃ¡logo Digital<br>
    <span id="total">Total: R$ 0,00</span>
  </div>
  <button id="enviarBtn" onclick="enviarWhatsApp()">ðŸ“¤ Enviar Pedido</button>
</header>

<div id="produtos-container"></div>

<script>
async function carregarProdutos() {
  const params = new URLSearchParams(window.location.search);
  const marcaSelecionada = params.get("marca") || "todos";

  const response = await fetch('produtos.json');
  const produtos = await response.json();

  const filtrados = marcaSelecionada === "todos" 
    ? produtos 
    : produtos.filter(p => p.marca === marcaSelecionada);

  const container = document.getElementById('produtos-container');
  container.innerHTML = '';

  filtrados.forEach((p, i) => {
    const div = document.createElement('div');
    div.className = 'produto';
    div.innerHTML = `
      <img src="${p.imagem}" alt="${p.descricao}">
      <div><strong>${p.descricao}</strong></div>
      <div>(${p.codigo})</div>
      <div>${p.marca}</div>
      <div>R$ ${p.valor.toFixed(2)}</div>
      <div class="qtd-container">
        <button onclick="alterarQtd(${i}, -1)">âˆ’</button>
        <input type="text" id="qtd${i}" value="0" readonly>
        <button onclick="alterarQtd(${i}, 1)">+</button>
      </div>
    `;
    container.appendChild(div);
  });

  window.produtos = filtrados;
}

function alterarQtd(i, delta) {
  const input = document.getElementById(`qtd${i}`);
  let valor = parseInt(input.value) + delta;
  if (valor < 0) valor = 0;
  input.value = valor;
  calcularTotal();
}

function calcularTotal() {
  let total = 0;
  window.produtos.forEach((p, i) => {
    const qtd = parseInt(document.getElementById(`qtd${i}`).value);
    total += qtd * p.valor;
  });
  document.getElementById('total').innerText = `Total: R$ ${total.toFixed(2)}`;
}

function enviarWhatsApp() {
  let mensagem = "ðŸ›’ *Pedido:*\n";
  let total = 0;

  window.produtos.forEach((p, i) => {
    const qtd = parseInt(document.getElementById(`qtd${i}`).value);
    if (qtd > 0) {
      mensagem += `â€¢ (${p.codigo}) ${p.descricao} - ${qtd} un.\n`;
      total += qtd * p.valor;
    }
  });

  mensagem += `\nðŸ’° Total: R$ ${total.toFixed(2)}`;
  const telefone = "5519992394899";
  const url = `https://wa.me/${telefone}?text=${encodeURIComponent(mensagem)}`;
  window.open(url, "_blank");
}

function voltar() {
  window.location.href = "index.html";
}

carregarProdutos();
</script>

</body>
</html>
