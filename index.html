<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Cat√°logo Digital</title>
<style>
body {font-family: Arial, sans-serif; margin:0; background:#f7f7f7; text-align:center;}
header {
    background:#2b7bba; color:white; padding:8px 12px; font-size:18px; font-weight:bold;
    position:sticky; top:0; z-index:10; display:flex; gap:12px;
    justify-content:space-between; align-items:center;
}
.header-left {display:flex; align-items:center; gap:8px;}
.header-right {display:flex; align-items:center; gap:8px;}
#version {font-size:12px; color:rgba(255,255,255,0.9); margin-right:6px;}
#total {font-size:15px; font-weight:bold;}
#marcas-container {display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin:10px;}
.marca-btn {
    flex: 1 1 120px;
    min-width: 130px;
    max-width: 160px;
    padding:10px;
    border:none;
    border-radius:10px;
    font-size:14px;
    background:#2b7bba;
    color:white;
    cursor:pointer;
    word-wrap:break-word;
    white-space:normal;
}
.marca-btn.tudo {
    background:#25d366;
    font-weight:bold;
}
#produtos-container {
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:12px;
    padding:12px;
    max-width:900px;
    margin:auto;
}
.produto {
    background:white;
    border-radius:12px;
    box-shadow:0 2px 5px rgba(0,0,0,0.1);
    padding:10px;
}
.produto img {
    width: 100%;
    height: 160px;
    object-fit: contain;
    border-radius: 10px;
    background: #fff;
}
.qtd-container {
    display:flex; align-items:center; justify-content:center; margin-top:5px;
}
.qtd-btn {
    width:28px; height:28px; border:none; border-radius:6px;
    background:#2b7bba; color:white; font-size:18px; font-weight:bold;
    cursor:pointer;
}
.qtd-input {
    width:40px; text-align:center; margin:0 5px; border:1px solid #ccc; border-radius:6px;
}
button#enviar {
    background:#25d366; color:white; border:none;
    padding:8px 12px; font-size:14px; border-radius:8px; cursor:pointer;
}
button#voltar {
    background:#2b7bba; color:white; border:none;
    padding:8px 12px; font-size:14px; border-radius:8px; cursor:pointer;
}
.hidden {display:none;}
/* pequeno estilo para o campo telefone */
#phone-form {display:flex; gap:6px; align-items:center;}
#user-phone {padding:6px 8px; border-radius:6px; border:1px solid rgba(255,255,255,0.3); width:150px; background:rgba(255,255,255,0.9); color:#000;}
#save-phone {padding:6px 8px; border-radius:6px; border:none; background:#ffffff; color:#2b7bba; cursor:pointer; font-weight:bold;}
#saved-phone {font-size:13px; color:rgba(255,255,255,0.95);}
.icon-cart {background:#ffffff; color:#2b7bba; padding:8px 12px; border-radius:10px; border:none; cursor:pointer; font-size:16px;}
/* carrinho - tela */
#tela-carrinho {max-width:900px; margin:16px auto; padding:12px;}
.cart-line {display:flex; gap:12px; align-items:center; background:#fff; padding:8px; border-radius:8px; margin-bottom:8px; box-shadow:0 1px 3px rgba(0,0,0,0.06);}
.cart-line img {width:64px; height:64px; object-fit:contain; border-radius:6px; background:#fff;}
.cart-line .desc {flex:1; text-align:left;}
.cart-line .line-actions {display:flex; align-items:center; gap:8px;}
.small-muted {font-size:12px; color:#666;}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <span id="version">v1.7</span>
    <button id="voltar" onclick="mostrarMarcas()" class="marca-btn" style="background:#ffffff;color:#2b7bba;">Marcas</button>
  </div>

  <div>
    <div>Cat√°logo Digital<br><span id="total">Total: R$ 0,00</span></div>
  </div>

  <div class="header-right">
    <!-- campo de telefone / exibi√ß√£o do salvo -->
    <div id="phone-form">
      <input id="user-phone" placeholder="Seu celular (DDDn√∫mero)" aria-label="Telefone">
      <button id="save-phone" onclick="savePhone()">Salvar</button>
    </div>
    <div id="saved-phone" class="hidden"></div>

    <!-- bot√£o carrinho (destaque branco com √≠cone) -->
    <button id="btn-carrinho" class="icon-cart" onclick="mostrarCarrinho()">üõí</button>

    <!-- bot√£o enviar (aparece somente na tela de carrinho) -->
    <button id="enviar" onclick="enviarWhatsApp()" class="hidden">üì¶ Enviar Pedido</button>
  </div>
</header>

<!-- TELA 1: MARCAS -->
<div id="tela-marcas">
  <h3>Escolha uma Marca</h3>
  <div id="marcas-container">
    <button class="marca-btn tudo" onclick="mostrarProdutos('Tudo')">Tudo</button>
    <button class="marca-btn" onclick="mostrarProdutos('Bauducco')">Bauducco</button>
    <button class="marca-btn" onclick="mostrarProdutos('Danone')">Danone</button>
    <button class="marca-btn" onclick="mostrarProdutos('Divinitos')">Divinitos</button>
    <button class="marca-btn" onclick="mostrarProdutos('Elma Chips')">Elma Chips</button>
    <button class="marca-btn" onclick="mostrarProdutos('FRITOP')">FRITOP</button>
    <button class="marca-btn" onclick="mostrarProdutos('Frutap')">Frutap</button>
    <button class="marca-btn" onclick="mostrarProdutos('Kremoso')">Kremoso</button>
    <button class="marca-btn" onclick="mostrarProdutos('Nestl√©')">Nestl√©</button>
    <button class="marca-btn" onclick="mostrarProdutos('Oz')">Oz Pipocas</button>
    <button class="marca-btn" onclick="mostrarProdutos('Rebeka')">Rebeka Pudim</button>
    <button class="marca-btn" onclick="mostrarProdutos('Rei da Massa')">Rei da Massa</button>
    <button class="marca-btn" onclick="mostrarProdutos('Sacola')">Sacolas</button>
  </div>
</div>

<!-- TELA 2: PRODUTOS -->
<div id="tela-produtos" class="hidden">
  <h3 id="titulo-marca"></h3>
  <div id="produtos-container"></div>
</div>

<!-- TELA CARRINHO -->
<div id="tela-carrinho" class="hidden">
  <h3>Seu Pedido</h3>
  <div id="carrinho-list"></div>
  <div style="text-align:right; margin-top:8px;">
    <div class="small-muted">Total:</div>
    <div id="total-carrinho" style="font-weight:bold; font-size:18px;">R$ 0,00</div>
  </div>
</div>

<script>
// =========================
// DADOS DE EXEMPLO (produtos)
// =========================
const produtos = [
  {"C√≥digo":"129","descricao":"Danette Chocol 360G","marca":"Danone","valor":82.56,"imagem":"https://imgur.com/CNshggM.png"},
  {"C√≥digo":"8921","descricao":"P√£o Visc. Trad","marca":"Bauducco","valor":39.90,"imagem":"https://via.placeholder.com/120"},
  {"C√≥digo":"5982","descricao":"Ruflle Churras 32GX56","marca":"Elma Chips","valor":167.44,"imagem":"https://via.placeholder.com/120"}
  // ... acrescente os outros produtos conforme necess√°rio
];

let carrinho = {}; // estrutura: { codigo: { ...produto, qtd } }

// =========================
// PHONE (localStorage) - chave
// =========================
const STORAGE_KEY = 'catalog_user_phone';

// Formata√ß√£o / valida√ß√£o
function onlyDigits(s){ return (s||'').toString().replace(/\D/g,''); }
function validaTelefoneBR(tel){
  const n = onlyDigits(tel);
  if (!n) return false;
  // DDD n√£o come√ßa com 0; aceita 10 ou 11 d√≠gitos (sem +55)
  return /^(?:[1-9][0-9])(?:9?[0-9]{8})$/.test(n);
}
function formatTelefoneBR(tel){
  const n = onlyDigits(tel);
  if (n.length === 10) return `+55 (${n.slice(0,2)}) ${n.slice(2,6)}-${n.slice(6)}`;
  if (n.length === 11) return `+55 (${n.slice(0,2)}) ${n.slice(2,7)}-${n.slice(7)}`;
  return tel;
}

// carregar telefone salvo (no load)
function loadPhoneToUI(){
  const saved = localStorage.getItem(STORAGE_KEY);
  const savedEl = document.getElementById('saved-phone');
  const phoneInput = document.getElementById('user-phone');
  if(saved && validaTelefoneBR(saved)){
    savedEl.classList.remove('hidden');
    savedEl.innerText = formatTelefoneBR(saved);
    phoneInput.value = saved; // preenche o campo
  } else {
    savedEl.classList.add('hidden');
    phoneInput.value = '';
  }
}

// salvar telefone
function savePhone(){
  const phoneInput = document.getElementById('user-phone');
  const v = phoneInput.value.trim();
  if(!validaTelefoneBR(v)){
    alert('Informe um telefone v√°lido com DDD (ex: 11999999999).');
    phoneInput.focus();
    return;
  }
  localStorage.setItem(STORAGE_KEY, onlyDigits(v));
  loadPhoneToUI();
  alert('N√∫mero salvo com sucesso.');
}

// obter telefone salvo (d√≠gitos)
function getSavedPhoneDigits(){
  const s = localStorage.getItem(STORAGE_KEY);
  return s ? onlyDigits(s) : null;
}

// =========================
// FUN√á√ïES DE UI / PRODUTOS
// =========================
function mostrarProdutos(marca){
  document.getElementById("tela-marcas").classList.add("hidden");
  document.getElementById("tela-carrinho").classList.add("hidden");
  document.getElementById("tela-produtos").classList.remove("hidden");
  document.getElementById("titulo-marca").textContent = marca === "Tudo" ? "Todos os Produtos" : "Marca: " + marca;

  const container = document.getElementById("produtos-container");
  container.innerHTML = "";

  produtos
    .filter(p => marca === "Tudo" || p.marca === marca)
    .forEach(prod => {
      const codigo = prod["C√≥digo"];
      const div = document.createElement("div");
      div.className = "produto";
      div.innerHTML = `
        <img src="${prod.imagem}" alt="${prod.descricao}">
        <h4>${prod.descricao}</h4>
        <small>(${codigo})</small>
        <p><b>R$ ${prod.valor.toFixed(2)}</b></p>
        <div class="qtd-container">
          <button class="qtd-btn" onclick="alterarQtd('${codigo}', -1)">-</button>
          <input class="qtd-input" id="qtd-${codigo}" value="${carrinho[codigo] ? carrinho[codigo].qtd : 0}">
          <button class="qtd-btn" onclick="alterarQtd('${codigo}', 1)">+</button>
        </div>
      `;
      container.appendChild(div);
    });
  // reset bot√£o enviar/visibilidade
  document.getElementById('enviar').classList.add('hidden');
  document.getElementById('btn-carrinho').classList.remove('hidden');
}

// voltar para marcas
function mostrarMarcas(){
  document.getElementById("tela-produtos").classList.add("hidden");
  document.getElementById("tela-carrinho").classList.add("hidden");
  document.getElementById("tela-marcas").classList.remove("hidden");
  document.getElementById('enviar').classList.add('hidden');
  document.getElementById('btn-carrinho').classList.remove('hidden');
}

// mostrar carrinho (tela dedicada)
function mostrarCarrinho(){
  document.getElementById("tela-marcas").classList.add("hidden");
  document.getElementById("tela-produtos").classList.add("hidden");
  document.getElementById("tela-carrinho").classList.remove("hidden");

  // mostrar bot√£o enviar no header e ocultar √≠cone grande se quiser
  document.getElementById('enviar').classList.remove('hidden');
  // ocultar √≠cone carrinho se preferir: document.getElementById('btn-carrinho').classList.add('hidden');

  renderCarrinhoList();
}

// =========================
// QTD / CARRINHO / TOTAL
// =========================
function alterarQtd(codigo, delta){
  const input = document.getElementById(`qtd-${codigo}`);
  // se input inexistente (caso vindo da tela do carrinho), tentar localizar por querySelector
  if(!input){
    // procura na lista do carrinho
    // no carrinho-list h√° inputs com id qdrc-<codigo>
  }
  let current = 0;
  if (input) current = parseInt(input.value) || 0;
  let qtd = current + delta;
  if (qtd < 0) qtd = 0;
  if (input) input.value = qtd;

  // sincroniza carrinho
  const prod = produtos.find(p => p["C√≥digo"] === codigo);
  if(!prod) return;
  if(qtd > 0){
    carrinho[codigo] = {...prod, qtd};
  } else {
    delete carrinho[codigo];
  }

  // atualizar inputs na outra tela (se vis√≠vel) - manter sincroniza√ß√£o
  const otherInput = document.querySelectorAll(`#qtd-${codigo}`);
  otherInput.forEach(el=>{
    if(el && el !== input) el.value = qtd;
  });

  atualizarTotal();
  // se estiver na tela do carrinho, atualizar listagem e total
  if(!document.getElementById("tela-carrinho").classList.contains('hidden')){
    renderCarrinhoList();
  }
}

function atualizarTotal(){
  let total = 0;
  for(let c in carrinho) total += (carrinho[c].valor * carrinho[c].qtd);
  document.getElementById("total").innerText = "Total: R$ " + total.toFixed(2);
  const totalCarrinho = document.getElementById("total-carrinho");
  if(totalCarrinho) totalCarrinho.innerText = "R$ " + total.toFixed(2);
}

// renderiza a tela do carrinho (linhas)
function renderCarrinhoList(){
  const list = document.getElementById('carrinho-list');
  list.innerHTML = '';
  const keys = Object.keys(carrinho);
  if(keys.length === 0){
    list.innerHTML = '<div class="small-muted">Seu carrinho est√° vazio.</div>';
    document.getElementById('enviar').disabled = true;
    atualizarTotal();
    return;
  }
  document.getElementById('enviar').disabled = false;
  keys.forEach(codigo=>{
    const p = carrinho[codigo];
    const line = document.createElement('div');
    line.className = 'cart-line';
    line.innerHTML = `
      <img src="${p.imagem}" alt="${p.descricao}">
      <div class="desc">
        <div><b>${p.descricao}</b></div>
        <div class="small-muted">(${p["C√≥digo"]}) ‚Ä¢ R$ ${p.valor.toFixed(2)}</div>
      </div>
      <div class="line-actions">
        <button class="qtd-btn" onclick="alterarQtd('${p["C√≥digo"]}', -1)">-</button>
        <input class="qtd-input" id="qdr-${p["C√≥digo"]}" value="${p.qtd}">
        <button class="qtd-btn" onclick="alterarQtd('${p["C√≥digo"]}', 1)">+</button>
      </div>
    `;
    list.appendChild(line);
    // sincroniza o input do carrinho para que mudan√ßa manual reflita
    const input = line.querySelector(`#qdr-${p["C√≥digo"]}`);
    input.addEventListener('change', function(){
      let v = parseInt(this.value) || 0;
      if(v < 0) v = 0;
      this.value = v;
      // atualizar carrinho e inputs equivalentes
      if(v > 0) carrinho[p["C√≥digo"]] = {...p, qtd: v};
      else delete carrinho[p["C√≥digo"]];
      // atualizar inputs na tela de produtos se existirem
      const prodInput = document.getElementById(`qtd-${p["C√≥digo"]}`);
      if(prodInput) prodInput.value = v;
      atualizarTotal();
      renderCarrinhoList(); // re-render para refletir remo√ß√£o quando 0
    });
  });
  atualizarTotal();
}

// =========================
// ENVIAR WHATSAPP (inclui n√∫mero salvo)
// =========================
function enviarWhatsApp(){
  // precisa de telefone salvo
  const saved = getSavedPhoneDigits();
  if(!saved){
    alert('Antes de enviar, cadastre seu telefone (com DDD) no campo ao lado e clique em Salvar.');
    return;
  }
  if(Object.keys(carrinho).length === 0){
    alert('Nenhum item no pedido!');
    return;
  }
  let msg = "üõí *Pedido:*%0A";
  for(let c in carrinho){
    const p = carrinho[c];
    msg += `‚Ä¢ ${p.descricao} (${p["C√≥digo"]}) - ${p.qtd} un.%0A`;
  }
  const total = Object.values(carrinho).reduce((a,b)=>a + (b.valor * b.qtd), 0);
  msg += `%0Aüí∞ *Total:* R$ ${total.toFixed(2)}%0A`;
  msg += `%0Aüì± *Contato do cliente:* ${formatTelefoneBR(saved)}`;

  // abre WhatsApp (destino = seu n√∫mero de atendimento)
  const numeroDestino = '5519992394899'; // altere se necess√°rio
  const url = "https://wa.me/" + numeroDestino + "?text=" + encodeURIComponent(msg);
  window.open(url, "_blank");
}

// =========================
// Inicializa√ß√£o
// =========================
window.addEventListener('DOMContentLoaded', () => {
  loadPhoneToUI();
  mostrarMarcas(); // in√≠cio na tela de marcas
});
</script>

</body>
</html>

